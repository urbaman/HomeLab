# Network for Proxmox

## Interface check

To check which interface is actually linked to which physical port, enable all of the interfaces. For each one:

```bash
ip link set dev eth1 up
```

Then, check where the following script gives a "1" result with the cable connected, moving the cable through the physical ports and taking note of the port-interface link.

```bash
for i in $( ls /sys/class/net ); do echo -n $i: ; cat /sys/class/net/$i/carrier; done
```

## Set the network (bonds, bridges, vlans)

```bash
# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

auto lo
iface lo inet loopback

auto eno2
iface eno2 inet manual
#wan0

auto eno1
iface eno1 inet manual
        mtu 9000
#vlan10 - LAN

auto eno4
iface eno4 inet manual
        mtu 9000
#bond-vlan30 Ceph Storage

auto eno3
iface eno3 inet manual
        mtu 9000
#bond-vlan30 - Ceph Storage

auto enp5s0f3
iface enp5s0f3 inet manual
        mtu 9000
#vlan50 - VMs LAN

auto enp5s0f2
iface enp5s0f2 inet manual
        mtu 9000
#bond-vlan70 Shared Storage

auto enp5s0f1
iface enp5s0f1 inet manual
        mtu 9000
#bond-vlan70 Shared Storage

auto enp5s0f0
iface enp5s0f0 inet manual
        mtu 9000
#bond-trunk

auto enp129s0f1
iface enp129s0f1 inet manual
        mtu 9000
#bond-trunk

auto enp129s0f0
iface enp129s0f0 inet manual
        mtu 9000
#vlan100 - Management

auto bond0
iface bond0 inet manual
        bond-slaves eno3 eno4
        bond-miimon 100
        bond-mode 802.3ad
        bond-xmit-hash-policy layer2+3
        mtu 9000
#vlan30 - Ceph Storage

auto bond1
iface bond1 inet manual
        bond-slaves enp5s0f1 enp5s0f2
        bond-miimon 100
        bond-mode 802.3ad
        bond-xmit-hash-policy layer2+3
        mtu 9000
#vlan70 - Shared Storage

auto bond2
iface bond2 inet manual
        bond-slaves enp129s0f1 enp5s0f0
        bond-miimon 100
        bond-mode 802.3ad
        bond-xmit-hash-policy layer2+3
        mtu 9000
#trunk

auto vmbr0
iface vmbr0 inet manual
        bridge-ports eno2
        bridge-stp off
        bridge-fd 0

auto vmbr1
iface vmbr1 inet manual
        bridge-ports eno1
        bridge-stp off
        bridge-fd 0
        mtu 9000
#vlan 10 - LAN

auto vmbr2
iface vmbr2 inet manual
        address 10.0.30.11/24
        bridge-ports bond0
        bridge-stp off
        bridge-fd 0
        mtu 9000
#vlan30 - Ceph Storage

auto vmbr3
iface vmbr3 inet manual
        bridge-ports enp5s0f3
        bridge-stp off
        bridge-fd 0
        mtu 9000
#vlan50 - VMs LAN

auto vmbr4
iface vmbr4 inet manual
        bridge-ports bond1
        bridge-stp off
        bridge-fd 0
        mtu 9000
#vlan70 - Shared Storage

auto vmbr5
iface vmbr5 inet manual
        bridge-ports bond2
        bridge-stp off
        bridge-fd 0
        bridge-vlan-aware yes
        bridge-vids 10 20 30 40 50 60 70 80 100
        mtu 9000
#trunk

auto vmbr5.20
iface vmbr5.20 inet static
        address 10.0.20.11/24
        mtu 9000
#vlan20 - Proxmox Cluster

auto vmbr5.40
iface vmbr5.40 inet static
        address 10.0.40.11/24
        mtu 9000
#vlan40 - Ceph Public

auto vmbr6
iface vmbr6 inet manual
        address 10.0.100.11/24
        gateway 10.0.100.3
        bridge-ports enp129s0f0
        bridge-stp off
        bridge-fd 0
        mtu 9000
#vlan100 - Management
```
